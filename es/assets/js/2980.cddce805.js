/*! For license information please see 2980.cddce805.js.LICENSE.txt */
"use strict";(self.webpackChunkdocs_fintesk_com=self.webpackChunkdocs_fintesk_com||[]).push([[2980],{32980:(e,t,r)=>{r.d(t,{a:()=>q,b:()=>J,c:()=>z,d:()=>F,e:()=>K,f:()=>Q,g:()=>V,h:()=>X,i:()=>Y});var s=r(88431),i=Object.create,n=Object.defineProperty,a=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,h=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,c=(0,s.a)(((e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports)),"A"),d=(0,s.a)(((e,t,r,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let h of o(t))!l.call(e,h)&&h!==r&&n(e,h,{get:(0,s.a)((()=>t[h]),"get"),enumerable:!(i=a(t,h))||i.enumerable});return e}),"Dt"),u=(0,s.a)(((e,t,r)=>(r=null!=e?i(h(e)):{},d(!t&&e&&e.__esModule?r:n(r,"default",{value:e,enumerable:!0}),e))),"Y"),p=c((e=>{function t(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function r(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function i(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function n(e,...t){if(!i(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function a(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");t(e.outputLen),t(e.blockLen)}function o(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function h(e,t){n(e);let r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}Object.defineProperty(e,"__esModule",{value:!0}),e.isBytes=i,e.number=t,e.bool=r,e.bytes=n,e.hash=a,e.exists=o,e.output=h,(0,s.a)(t,"R"),(0,s.a)(r,"me"),(0,s.a)(i,"ge"),(0,s.a)(n,"X"),(0,s.a)(a,"ye"),(0,s.a)(o,"Se"),(0,s.a)(h,"be");var l={number:t,bool:r,bytes:n,hash:a,exists:o,output:h};e.default=l})),f=c((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.add5L=e.add5H=e.add4H=e.add4L=e.add3H=e.add3L=e.rotlBL=e.rotlBH=e.rotlSL=e.rotlSH=e.rotr32L=e.rotr32H=e.rotrBL=e.rotrBH=e.rotrSL=e.rotrSH=e.shrSL=e.shrSH=e.toBig=void 0,e.fromBig=i,e.split=n,e.add=v;var t=BigInt(2**32-1),r=BigInt(32);function i(e,s=!1){return s?{h:Number(e&t),l:Number(e>>r&t)}:{h:0|Number(e>>r&t),l:0|Number(e&t)}}function n(e,t=!1){let r=new Uint32Array(e.length),s=new Uint32Array(e.length);for(let n=0;n<e.length;n++){let{h:a,l:o}=i(e[n],t);[r[n],s[n]]=[a,o]}return[r,s]}(0,s.a)(i,"ee"),(0,s.a)(n,"Ie");var a=(0,s.a)(((e,t)=>BigInt(e>>>0)<<r|BigInt(t>>>0)),"Te");e.toBig=a;var o=(0,s.a)(((e,t,r)=>e>>>r),"we");e.shrSH=o;var h=(0,s.a)(((e,t,r)=>e<<32-r|t>>>r),"xe");e.shrSL=h;var l=(0,s.a)(((e,t,r)=>e>>>r|t<<32-r),"Ae");e.rotrSH=l;var c=(0,s.a)(((e,t,r)=>e<<32-r|t>>>r),"Oe");e.rotrSL=c;var d=(0,s.a)(((e,t,r)=>e<<64-r|t>>>r-32),"Ee");e.rotrBH=d;var u=(0,s.a)(((e,t,r)=>e>>>r-32|t<<64-r),"Pe");e.rotrBL=u;var p=(0,s.a)(((e,t)=>t),"ve");e.rotr32H=p;var f=(0,s.a)(((e,t)=>e),"Ce");e.rotr32L=f;var g=(0,s.a)(((e,t,r)=>e<<r|t>>>32-r),"_e");e.rotlSH=g;var y=(0,s.a)(((e,t,r)=>t<<r|e>>>32-r),"Ne");e.rotlSL=y;var m=(0,s.a)(((e,t,r)=>t<<r-32|e>>>64-r),"De");e.rotlBH=m;var w=(0,s.a)(((e,t,r)=>e<<r-32|t>>>64-r),"ke");function v(e,t,r,s){let i=(t>>>0)+(s>>>0);return{h:e+r+(i/2**32|0)|0,l:0|i}}e.rotlBL=w,(0,s.a)(v,"Le");var b=(0,s.a)(((e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0)),"Re");e.add3L=b;var k=(0,s.a)(((e,t,r,s)=>t+r+s+(e/2**32|0)|0),"Me");e.add3H=k;var S=(0,s.a)(((e,t,r,s)=>(e>>>0)+(t>>>0)+(r>>>0)+(s>>>0)),"Be");e.add4L=S;var I=(0,s.a)(((e,t,r,s,i)=>t+r+s+i+(e/2**32|0)|0),"Ue");e.add4H=I;var x=(0,s.a)(((e,t,r,s,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(s>>>0)+(i>>>0)),"ze");e.add5L=x;var C=(0,s.a)(((e,t,r,s,i,n)=>t+r+s+i+n+(e/2**32|0)|0),"He");e.add5H=C;var A={fromBig:i,split:n,toBig:a,shrSH:o,shrSL:h,rotrSH:l,rotrSL:c,rotrBH:d,rotrBL:u,rotr32H:p,rotr32L:f,rotlSH:g,rotlSL:y,rotlBH:m,rotlBL:w,add:v,add3L:b,add3H:k,add4L:S,add4H:I,add5H:C,add5L:x};e.default=A})),g=c((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.crypto=void 0,e.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0})),y=c((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Hash=e.nextTick=e.byteSwapIfBE=e.byteSwap=e.isLE=e.rotl=e.rotr=e.createView=e.u32=e.u8=void 0,e.isBytes=i,e.byteSwap32=d,e.bytesToHex=f,e.hexToBytes=w,e.asyncLoop=b,e.utf8ToBytes=k,e.toBytes=S,e.concatBytes=I,e.checkOpts=A,e.wrapConstructor=L,e.wrapConstructorWithOpts=T,e.wrapXOFConstructorWithOpts=O,e.randomBytes=_;var t=g(),r=p();function i(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}(0,s.a)(i,"Rt");var n=(0,s.a)((e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),"Mt");e.u8=n;var a=(0,s.a)((e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))),"Bt");e.u32=a;var o=(0,s.a)((e=>new DataView(e.buffer,e.byteOffset,e.byteLength)),"Ut");e.createView=o;var h=(0,s.a)(((e,t)=>e<<32-t|e>>>t),"zt");e.rotr=h;var l=(0,s.a)(((e,t)=>e<<t|e>>>32-t>>>0),"Ht");e.rotl=l,e.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];var c=(0,s.a)((e=>e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255),"Ft");function d(t){for(let r=0;r<t.length;r++)t[r]=(0,e.byteSwap)(t[r])}e.byteSwap=c,e.byteSwapIfBE=e.isLE?e=>e:t=>(0,e.byteSwap)(t),(0,s.a)(d,"Wt");var u=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function f(e){(0,r.bytes)(e);let t="";for(let r=0;r<e.length;r++)t+=u[e[r]];return t}(0,s.a)(f,"$t");var y={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function m(e){return e>=y._0&&e<=y._9?e-y._0:e>=y._A&&e<=y._F?e-(y._A-10):e>=y._a&&e<=y._f?e-(y._a-10):void 0}function w(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let s=new Uint8Array(r);for(let i=0,n=0;i<r;i++,n+=2){let t=m(e.charCodeAt(n)),r=m(e.charCodeAt(n+1));if(void 0===t||void 0===r){let t=e[n]+e[n+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+n)}s[i]=16*t+r}return s}(0,s.a)(m,"Ve"),(0,s.a)(w,"jt");var v=(0,s.a)((async()=>{}),"Jt");async function b(t,r,s){let i=Date.now();for(let n=0;n<t;n++){s(n);let t=Date.now()-i;t>=0&&t<r||(await(0,e.nextTick)(),i+=t)}}function k(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}function S(e){return"string"==typeof e&&(e=k(e)),(0,r.bytes)(e),e}function I(...e){let t=0;for(let i=0;i<e.length;i++){let s=e[i];(0,r.bytes)(s),t+=s.length}let s=new Uint8Array(t);for(let r=0,i=0;r<e.length;r++){let t=e[r];s.set(t,i),i+=t.length}return s}e.nextTick=v,(0,s.a)(b,"Kt"),(0,s.a)(k,"$e"),(0,s.a)(S,"U"),(0,s.a)(I,"qt");var x=class{static{(0,s.a)(this,"te")}clone(){return this._cloneInto()}};e.Hash=x;var C={}.toString;function A(e,t){if(void 0!==t&&"[object Object]"!==C.call(t))throw new Error("Options should be object or undefined");return Object.assign(e,t)}function L(e){let t=(0,s.a)((t=>e().update(S(t)).digest()),"e"),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function T(e){let t=(0,s.a)(((t,r)=>e(r).update(S(t)).digest()),"e"),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}function O(e){let t=(0,s.a)(((t,r)=>e(r).update(S(t)).digest()),"e"),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}function _(e=32){if(t.crypto&&"function"==typeof t.crypto.getRandomValues)return t.crypto.getRandomValues(new Uint8Array(e));if(t.crypto&&"function"==typeof t.crypto.randomBytes)return t.crypto.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}(0,s.a)(A,"Yt"),(0,s.a)(L,"Xt"),(0,s.a)(T,"Qt"),(0,s.a)(O,"Zt"),(0,s.a)(_,"en")})),m=c((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.shake256=e.shake128=e.keccak_512=e.keccak_384=e.keccak_256=e.keccak_224=e.sha3_512=e.sha3_384=e.sha3_256=e.sha3_224=e.Keccak=void 0,e.keccakP=k;var t=p(),r=f(),i=y(),n=[],a=[],o=[],h=BigInt(0),l=BigInt(1),c=BigInt(2),d=BigInt(7),u=BigInt(256),g=BigInt(113);for(let s=0,p=l,f=1,y=0;s<24;s++){[f,y]=[y,(2*f+3*y)%5],n.push(2*(5*y+f)),a.push((s+1)*(s+2)/2%64);let e=h;for(let t=0;t<7;t++)p=(p<<l^(p>>d)*g)%u,p&c&&(e^=l<<(l<<BigInt(t))-l);o.push(e)}var[m,w]=(0,r.split)(o,!0),v=(0,s.a)(((e,t,s)=>s>32?(0,r.rotlBH)(e,t,s):(0,r.rotlSH)(e,t,s)),"Je"),b=(0,s.a)(((e,t,s)=>s>32?(0,r.rotlBL)(e,t,s):(0,r.rotlSL)(e,t,s)),"Ke");function k(e,t=24){let r=new Uint32Array(10);for(let s=24-t;s<24;s++){for(let s=0;s<10;s++)r[s]=e[s]^e[s+10]^e[s+20]^e[s+30]^e[s+40];for(let s=0;s<10;s+=2){let t=(s+8)%10,i=(s+2)%10,n=r[i],a=r[i+1],o=v(n,a,1)^r[t],h=b(n,a,1)^r[t+1];for(let r=0;r<50;r+=10)e[s+r]^=o,e[s+r+1]^=h}let t=e[2],i=e[3];for(let r=0;r<24;r++){let s=a[r],o=v(t,i,s),h=b(t,i,s),l=n[r];t=e[l],i=e[l+1],e[l]=o,e[l+1]=h}for(let s=0;s<50;s+=10){for(let t=0;t<10;t++)r[t]=e[s+t];for(let t=0;t<10;t++)e[s+t]^=~r[(t+2)%10]&r[(t+4)%10]}e[0]^=m[s],e[1]^=w[s]}r.fill(0)}(0,s.a)(k,"Xe");var S=class e extends i.Hash{static{(0,s.a)(this,"t")}constructor(e,r,s,n=!1,a=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=s,this.enableXOF=n,this.rounds=a,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,t.number)(s),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,i.u32)(this.state)}keccak(){i.isLE||(0,i.byteSwap32)(this.state32),k(this.state32,this.rounds),i.isLE||(0,i.byteSwap32)(this.state32),this.posOut=0,this.pos=0}update(e){(0,t.exists)(this);let{blockLen:r,state:s}=this,n=(e=(0,i.toBytes)(e)).length;for(let t=0;t<n;){let i=Math.min(r-this.pos,n-t);for(let r=0;r<i;r++)s[this.pos++]^=e[t++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:s}=this;e[r]^=t,128&t&&r===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){(0,t.exists)(this,!1),(0,t.bytes)(e),this.finish();let r=this.state,{blockLen:s}=this;for(let t=0,i=e.length;t<i;){this.posOut>=s&&this.keccak();let n=Math.min(s-this.posOut,i-t);e.set(r.subarray(this.posOut,this.posOut+n),t),this.posOut+=n,t+=n}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,t.number)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,t.output)(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){let{blockLen:r,suffix:s,outputLen:i,rounds:n,enableXOF:a}=this;return t||(t=new e(r,s,i,a,n)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=n,t.suffix=s,t.outputLen=i,t.enableXOF=a,t.destroyed=this.destroyed,t}};e.Keccak=S;var I=(0,s.a)(((e,t,r)=>(0,i.wrapConstructor)((()=>new S(t,e,r)))),"T");e.sha3_224=I(6,144,28),e.sha3_256=I(6,136,32),e.sha3_384=I(6,104,48),e.sha3_512=I(6,72,64),e.keccak_224=I(1,144,28),e.keccak_256=I(1,136,32),e.keccak_384=I(1,104,48),e.keccak_512=I(1,72,64);var x=(0,s.a)(((e,t,r)=>(0,i.wrapXOFConstructorWithOpts)(((s={})=>new S(t,e,void 0===s.dkLen?r:s.dkLen,!0)))),"Qe");e.shake128=x(31,168,16),e.shake256=x(31,136,32)})),w=c(((e,t)=>{var{sha3_512:r}=m(),i=(0,s.a)(((e=4,t=Math.random)=>{let r="";for(;r.length<e;)r+=Math.floor(36*t()).toString(36);return r}),"re");function n(e){let t=BigInt(8),r=BigInt(0);for(let s of e.values()){r=(r<<t)+BigInt(s)}return r}(0,s.a)(n,"nt");var a=(0,s.a)(((e="")=>n(r(e)).toString(36).slice(1)),"rt"),o=Array.from({length:26},((e,t)=>String.fromCharCode(t+97))),h=(0,s.a)((e=>o[Math.floor(e()*o.length)]),"un"),l=(0,s.a)((({globalObj:e=(typeof global<"u"?global:typeof window<"u"?window:{}),random:t=Math.random}={})=>{let r=Object.keys(e).toString(),s=r.length?r+i(32,t):i(32,t);return a(s).substring(0,32)}),"st"),c=(0,s.a)((e=>()=>e++),"ot"),d=(0,s.a)((({random:e=Math.random,counter:t=c(Math.floor(476782367*e())),length:r=24,fingerprint:s=l({random:e})}={})=>function(){let n=h(e),o=Date.now().toString(36),l=t().toString(36),c=i(r,e);return`${n+a(`${o+c+l+s}`).substring(1,r)}`}),"it"),u=d(),p=(0,s.a)(((e,{minLength:t=2,maxLength:r=32}={})=>{let s=e.length,i=/^[a-z][0-9a-z]+$/;try{if("string"==typeof e&&s>=t&&s<=r&&i.test(e))return!0}finally{}return!1}),"fn");t.exports.getConstants=()=>({defaultLength:24,bigLength:32}),t.exports.init=d,t.exports.createId=u,t.exports.bufToBigInt=n,t.exports.createCounter=c,t.exports.createFingerprint=l,t.exports.isCuid=p})),v=c(((e,t)=>{var{createId:r,init:s,getConstants:i,isCuid:n}=w();t.exports.createId=r,t.exports.init=s,t.exports.getConstants=i,t.exports.isCuid=n})),b=u(v(),1),k=Object.keys({arabic:"ar",armenian:"am",bulgarian:"bg",danish:"dk",dutch:"nl",english:"en",finnish:"fi",french:"fr",german:"de",greek:"gr",hungarian:"hu",indian:"in",indonesian:"id",irish:"ie",italian:"it",lithuanian:"lt",nepali:"np",norwegian:"no",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"rs",slovenian:"ru",spanish:"es",swedish:"se",tamil:"ta",turkish:"tr",ukrainian:"uk",sanskrit:"sk"});Date.now().toString().slice(5);var S=BigInt(1e3),I=BigInt(1e6),x=BigInt(1e9);function C(e){return"number"==typeof e&&(e=BigInt(e)),e<S?`${e}ns`:e<I?e/S+"\u03bcs":e<x?e/I+"ms":e/x+"s"}function A(e){return{raw:Number(e),formatted:C(e)}}(0,s.a)(C,"dt"),k.join("\n - "),(0,s.a)(A,"oe");var L="2.1.4",T=L,O=u(v(),1),_="orama_user_id";function P(e){let[t,...r]=e.split("\n"),s=r.join("\n").replace("data: ","");return{event:t.replace("event: ",""),data:s}}function B(e){return"object"==typeof e?JSON.stringify(e):`${e}`}(0,s.a)(P,"bt"),(0,s.a)(B,"ae");var E=class{static{(0,s.a)(this,"H")}messages;inferenceType;oramaClient;endpoint;abortController;events;userContext;conversationID;lastInteractionParams;state=[];systemPrompts;constructor(e){let t=e.oramaClient.answersApiBaseURL||"https://answer.api.orama.com";this.messages=e.initialMessages||[],this.inferenceType=e.inferenceType,this.oramaClient=e.oramaClient,this.endpoint=`${t}/v1/answer?api-key=${this.oramaClient.api_key}`,this.events=e.events,this.conversationID=(0,O.createId)(),this.userContext=e.userContext}async askStream(e){return this.messages.push({role:"user",content:e.term??""}),this.fetchAnswer(e)}async ask(e){let t=await this.askStream(e),r="";for await(let s of t)r=s;return this.events?.onMessageChange&&this.events.onMessageChange(this.messages),r}getMessages(){return this.messages}clearSession(){this.messages=[],this.state=[],this.events?.onMessageChange&&this.events.onMessageChange(this.messages),this.events?.onStateChange&&this.events.onStateChange(this.state)}abortAnswer(){if(!this.abortController)throw new Error("AbortController is not ready");this.abortController.abort(),this.abortController=void 0,this.state[this.state.length-1].aborted=!0}async regenerateLast({stream:e=!0}={}){if(0===this.state.length||0===this.messages.length)throw new Error("No messages to regenerate");if("assistant"!==this.messages.at(-1)?.role)throw new Error("Last message is not an assistant message");return this.messages.pop(),this.state.pop(),e?this.askStream(this.lastInteractionParams):this.ask(this.lastInteractionParams)}addNewEmptyAssistantMessage(){this.messages.push({role:"assistant",content:""})}async*fetchAnswer(e){this.abortController=new AbortController,this.lastInteractionParams=e;let t=(0,O.createId)(),r=null,s=this.state.length;this.state.push({interactionId:t,query:e.term??"",response:"",relatedQueries:null,sources:null,translatedQuery:null,segment:null,trigger:null,aborted:!1,loading:!0,error:!1,errorMessage:null});try{this.events?.onNewInteractionStarted&&this.events.onNewInteractionStarted(t),this.events?.onStateChange&&this.events.onStateChange(this.state);let n=new URLSearchParams;n.append("type",this.inferenceType),n.append("messages",JSON.stringify(this.messages)),n.append("query",e.term??""),n.append("conversationId",this.conversationID),n.append("userId",this.oramaClient.getUserId()),n.append("endpoint",this.oramaClient.endpoint),n.append("searchParams",JSON.stringify(e)),n.append("identity",this.oramaClient.getIdentity()??""),n.append("interactionId",t),n.append("alias",this.oramaClient.getAlias()??"");let a=this.getSystemPromptConfiguration();if(a&&n.append("systemPrompts",JSON.stringify(a)),this.userContext&&n.append("userContext",B(this.userContext)),e.userData&&n.append("userData",B(e.userData)),e.related){if(e.related?.howMany&&e.related?.howMany>5)throw new Error("Can generate at most 5 related queries");n.append("related",JSON.stringify({enabled:!0,howMany:e.related.howMany??3,format:e.related.format??"question"}))}let o=await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString(),signal:this.abortController.signal});if(!o.ok||!o.body)throw new Error(o.statusText);r=o.body.getReader();let h=new TextDecoder,l=[],c="";this.events?.onMessageLoading&&this.events.onMessageLoading(!0),this.addNewEmptyAssistantMessage();let d=this.messages.at(-1);for(;;){let e,{value:t,done:n}=await r.read();if(n)break;for(c+=h.decode(t,{stream:!0});-1!==(e=c.indexOf("\n\n"));){let t=c.slice(0,e);c=c.slice(e+2);try{let e=P(t),r=JSON.parse(e.data);if("sources"===r.type)this.state[s].sources=r.message,this.events?.onSourceChange&&this.events.onSourceChange(r.message),this.events?.onStateChange&&this.events.onStateChange(this.state);else if("query-translated"===r.type)this.state[s].translatedQuery=r.message,this.events?.onQueryTranslated&&this.events.onQueryTranslated(r.message),this.events?.onStateChange&&this.events.onStateChange(this.state);else if("conversation-metadata"===r.type){let{segment:e,trigger:t}=r.message;e&&(this.state[s].segment=e),t&&(this.state[s].trigger=t),this.events?.onStateChange&&this.events.onStateChange(this.state)}else if("related-queries"===r.type)this.state[s].relatedQueries=r.message,this.events?.onRelatedQueries&&this.events.onRelatedQueries(r.message),this.events?.onStateChange&&this.events.onStateChange(this.state);else if("text"===r.type)for(l.push(r.message);l.length>0;)d.content+=l.shift(),this.state[s].response=d.content,this.events?.onStateChange&&this.events.onStateChange(this.state),this.events?.onMessageChange&&this.events.onMessageChange(this.messages),yield d.content}catch(i){console.error("Error parsing SSE event:",i),console.error("Raw message:",t)}}}}catch(n){if("AbortError"!==n.name)throw this.state[s].error=!0,this.state[s].errorMessage=n.message??"Unknown error",n;this.state[s].aborted=!0,this.events?.onAnswerAborted&&this.events.onAnswerAborted(!0)}finally{r?.releaseLock(),this.state[s].loading=!1,this.events?.onStateChange&&this.events.onStateChange(this.state),this.events?.onInteractionDone&&this.events.onInteractionDone(this.state[s]),this.events?.onMessageLoading&&this.events.onMessageLoading(!1)}}setSystemPromptConfiguration(e){if(Array.isArray(e.systemPrompts)){if(!e.systemPrompts.every((e=>"string"==typeof e)))throw new Error("Invalid system prompt configuration");this.systemPrompts=e.systemPrompts}return this}getSystemPromptConfiguration(){return this.systemPrompts}},U=class{static{(0,s.a)(this,"F")}cache;config;constructor(e){this.cache=new Map,this.config=e}set(e,t){this.cache.set(e,t)}get(e){return this.cache.get(e)}has(e){return this.cache.has(e)}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}size(){return this.cache.size}};function H(e,t){typeof navigator<"u"?typeof navigator.sendBeacon<"u"&&navigator.sendBeacon(e,t):fetch(e,{method:"POST",body:t,headers:{"Content-Type":"application/json"}}).then((()=>{}),(e=>console.log(e)))}(0,s.a)(H,"O");var M=class e{static{(0,s.a)(this,"t")}data;params;config;profile;constructor(e,t){this.data=[],this.config=e,this.profile=t}setParams(e){this.params=e}static create(t,r){let s=new e(t,r);return s.start(),s}add(e){this.data.push({rawSearchString:e.rawSearchString,query:e.query,resultsCount:e.resultsCount,roundTripTime:e.roundTripTime,searchedAt:e.searchedAt,userId:this.profile.getUserId(),identity:this.profile.getIdentity(),alias:this.profile.getAlias(),referer:typeof location<"u"?location.toString():void 0}),null!=this.params&&this.data.length>=this.config.flushSize&&this.flush()}flush(){if(null==this.params||0===this.data.length)return;let e=this.data;this.data=[];let t={source:"fe",deploymentID:this.params.deploymentID,index:this.params.index,oramaId:this.config.id,oramaVersion:T,userAgent:typeof navigator<"u"?navigator.userAgent:void 0,events:e};H(`${this.params.endpoint}?api-key=${this.config.api_key}`,JSON.stringify(t))?.catch((e=>console.log(e)))}start(){let e=setInterval(this.flush.bind(this),this.config.flushInterval);null!=e.unref&&e.unref()}},D=class{static{(0,s.a)(this,"V")}constructor(e){this.params=e}intervalId;start(){this.stop(),this.intervalId=setInterval(this.beat.bind(this),this.params.frequency)}stop(){void 0!==this.intervalId&&clearInterval(this.intervalId)}beat(){H(this.params.endpoint)?.catch((e=>console.log(e)))}},$=u(v(),1),R=class{static{(0,s.a)(this,"j")}endpoint;apiKey;userId;identity;userAlias;params;constructor({endpoint:e,apiKey:t}){if(!e||!t)throw new Error("Endpoint and API Key are required to create a Profile");if("string"!=typeof e||"string"!=typeof t)throw new Error("Endpoint and API Key must be strings");if(typeof localStorage<"u"){let e=localStorage.getItem(_);e?this.userId=e:(this.userId=(0,$.createId)(),localStorage.setItem(_,this.userId))}else this.userId=(0,$.createId)();this.endpoint=e,this.apiKey=t}setParams(e){let{protocol:t,host:r}=new URL(e.identifyUrl),s=`${t}//${r}/identify`;this.params={identifyUrl:s,index:e.index}}getIdentity(){return this.identity}getUserId(){return this.userId}getAlias(){return this.userAlias}async sendProfileData(e){if(!this.params)throw new Error("Orama Profile is not initialized");let t=JSON.stringify({...e,visitorId:this.getUserId(),index:this.params.index});await H(`${this.params?.identifyUrl}?api-key=${this.apiKey}`,t)}async identify(e,t){if("string"!=typeof t)throw new Error("Identity must be a string");await e,await this.sendProfileData({entity:"identity",id:t}),this.identity=t}async alias(e,t){if("string"!=typeof t)throw new Error("Identity must be a string");await e,await this.sendProfileData({entity:"alias",id:t}),this.userAlias=t}reset(){this.userId=(0,$.createId)(),this.identity=void 0,this.userAlias=void 0}};function j(e){return void 0!==e&&void 0!==e?.signal}(0,s.a)(j,"vn");var N=class{static{(0,s.a)(this,"It")}id=(0,b.createId)();api_key;endpoint;multiIndexSearch;mergeResults;multiIndexIndexes;answersApiBaseURL;collector;cache;profile;searchDebounceTimer;searchRequestCounter=0;blockSearchTillAuth=!1;heartbeat;initPromise;constructor(e){if("indexes"in e){this.api_key=e.indexes[0].api_key,this.multiIndexIndexes=e.indexes;let t=new URL(e.indexes[0].endpoint).origin;if(e.indexes.some((e=>new URL(e.endpoint).origin!==t)))throw new Error("All indexes must have the same endpoint origin");this.endpoint=t+"/v1/indexes",this.multiIndexSearch=!0,this.mergeResults=e.mergeResults??!0}else this.api_key=e.api_key,this.endpoint=e.endpoint,this.multiIndexSearch=!1,this.mergeResults=!0;if(this.answersApiBaseURL=e.answersApiBaseURL,this.profile=new R({endpoint:this.endpoint,apiKey:this.api_key}),!1!==e.telemetry){let t={id:this.id,api_key:this.api_key,flushInterval:e.telemetry?.flushInterval??5e3,flushSize:e.telemetry?.flushSize??25};this.collector=M.create(t,this.profile)}if(!1!==e.cache){let e={};this.cache=new U(e)}this.init()}customerUserToken=void 0;searchToken=void 0;setAuthToken(e){null===e?(this.customerUserToken=void 0,this.searchToken=void 0):(this.customerUserToken=e,this.searchToken=void 0),this.init()}onAuthTokenExpired;setOnAuthTokenExpired(e){this.onAuthTokenExpired=e}addSearchResultsToCollector(e,t,r,s){if(this.collector)if(Array.isArray(e))for(let i of e)this.collector.add({rawSearchString:r.term,resultsCount:i.hits?.length??0,roundTripTime:t,query:r,cached:s,searchedAt:new Date,userId:this.profile.getUserId()});else this.collector.add({rawSearchString:r.term,resultsCount:e?.hits?.length??0,roundTripTime:t,query:r,cached:s,searchedAt:new Date,userId:this.profile.getUserId()})}async search(e,t){if(await this.initPromise,this.blockSearchTillAuth)return console.warn("Search request blocked until user is authenticated"),null;let r,i=++this.searchRequestCounter,n=`search-${JSON.stringify(e)}`,a=null,o=!1,h=!0!==t?.fresh&&this.cache?.has(n),l=(0,s.a)((async()=>{try{let s=Date.now();a=this.multiIndexSearch?await this.fetch("multi_search","POST",{q:{...e,mergeResults:this.mergeResults},sst:this.searchToken,indexes:this.multiIndexIndexes},t?.abortController):await this.fetch("search","POST",{q:e,sst:this.searchToken},t?.abortController);let i=Date.now();r=i-s;let o=await A(BigInt(1e6*i-1e6*s));if(Array.isArray(a))for(let e of a)e.elapsed=o;else a.elapsed=o;this.cache?.set(n,a)}catch(s){if("AbortError"!==s.name)throw console.error("Search request failed",s),s}return this.addSearchResultsToCollector(a,r,e,o),a}),"h");return h&&this.cache?(r=0,a=this.cache.get(n),o=!0,this.addSearchResultsToCollector(a,r,e,o),i===this.searchRequestCounter?a:null):t?.debounce?new Promise(((e,r)=>{clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=setTimeout((async()=>{try{await l(),e(a)}catch(t){"AbortError"!==t.name&&(console.error("Search request failed",t),r(t))}}),t?.debounce||300),"unref"in this.searchDebounceTimer&&this.searchDebounceTimer.unref()})):l()}async vectorSearch(e,t){await this.initPromise;let r,s,i=`vectorSearch-${JSON.stringify(e)}`,n=!1;if(!0===(!0!==t?.fresh&&this.cache?.has(i))&&null!=this.cache)r=0,s=this.cache.get(i),n=!0;else{let n=Date.now();s=await this.fetch("vector-search2","POST",{q:e},t?.abortSignal??t?.abortController);let a=Date.now();s.elapsed=await A(BigInt(1e6*a-1e6*n)),r=a-n,this.cache?.set(i,s)}return null!=this.collector&&this.collector.add({rawSearchString:e.term,resultsCount:s.hits?.length??0,roundTripTime:r,query:e,cached:n,searchedAt:new Date,userId:this.profile.getUserId()}),s}createAnswerSession(e){return new E({inferenceType:e?.inferenceType||"documentation",initialMessages:e?.initialMessages||[],oramaClient:this,events:e?.events,userContext:e?.userContext,systemPrompts:e?.systemPrompts??[]})}startHeartBeat(e){this.heartbeat?.stop(),this.heartbeat=new D({...e,endpoint:`${this.endpoint}/health?api-key=${this.api_key}`}),this.heartbeat.start()}stopHeartBeat(){this.heartbeat?.stop()}async getPop(){return(await this.initPromise)?.pop??""}expirationTimer;init(){let e=["init","GET",void 0,void 0,{token:this.customerUserToken}];this.multiIndexSearch&&(e=["init_multi_search","POST",{indexes:this.multiIndexIndexes},void 0,{token:this.customerUserToken}]),this.initPromise=this.fetch(...e).then((e=>{if(this.collector?.setParams({endpoint:e.collectUrl,deploymentID:e.deploymentID,index:e.index}),this.profile?.setParams({identifyUrl:e.collectUrl,index:e.index}),e.searchSession)if("required"in e.searchSession&&!0===e.searchSession.required)this.blockSearchTillAuth=!0;else if("token"in e.searchSession){let t=e.searchSession.token;this.searchToken=t;let r=e.searchSession.maxAge;this.blockSearchTillAuth=!1,this.expirationTimer&&clearTimeout(this.expirationTimer),this.expirationTimer=setTimeout((()=>{this.searchToken===t&&(this.searchToken=void 0,this.blockSearchTillAuth=!0,this.onAuthTokenExpired?.(t))}),1e3*r),"unref"in this.expirationTimer&&this.expirationTimer.unref()}return e})).catch((e=>(console.log(e),null)))}async fetch(e,t,r,s,i){let n=j(s)?s?.signal:s;if(!0===n?.aborted)throw new Error("Request aborted");let a={method:t,headers:{"Content-Type":"application/x-www-form-urlencoded"},signal:n};if("POST"===t&&void 0!==r){let e=r;e.version=L,e.id=this.id,e.visitorId=this.profile.getUserId(),a.body=Object.entries(e).filter((([e,t])=>!!t)).map((([e,t])=>`${e}=${encodeURIComponent(JSON.stringify(t))}`)).join("&")}let o=new URL(`${this.endpoint}/${e}`);if(this.multiIndexSearch||o.searchParams.append("api-key",this.api_key),i)for(let[l,c]of Object.entries(i))c&&o.searchParams.append(l,c);let h=await fetch(o,a);if(!h.ok){let e=new Error;throw e.httpResponse=h,e}return await h.json()}getIdentity(){return this.profile.getIdentity()}getUserId(){return this.profile.getUserId()}getAlias(){return this.profile.getAlias()}async identify(e){if(void 0===this.initPromise)throw new Error("OramaClient not initialized");await this.profile.identify(this.initPromise,e)}async alias(e){if(void 0===this.initPromise)throw new Error("OramaClient not initialized");await this.profile.alias(this.initPromise,e)}reset(){this.profile.reset()}};function q(e,t,r="[focus-on-arrow-nav]"){if("ArrowDown"!==t.key&&"ArrowUp"!==t.key)return;t.stopPropagation(),t.preventDefault();let s=e.querySelectorAll(r),i=Array.from(s);i=i.filter((e=>-1!==e.tabIndex));let n,a=i[0],o=i[i.length-1],h=e.querySelector(":focus"),l=i.indexOf(h);"ArrowDown"===t.key?(n=l===i.length-1?a:i[l+1],n?.focus()):"ArrowUp"===t.key&&(n=0===l?o:i[l-1],n?.focus())}function J(e){var t;if(null!==(t=navigator.clipboard)&&void 0!==t&&t.writeText)navigator.clipboard.writeText(e).catch((e=>{console.error("Could not copy text: ",e)}));else{let t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}function z(e,t){return Array.from(e.attributes).reduce(((e,r)=>(t.includes(r.name)||(e[r.name]=r.value),e)),{})}function F(e,t,r){let s=`\n    Component: ${e.tagName.toLowerCase()}\n    Id: ${e.id}\n  `;if(!t&&!r)throw new Error(`Invalid component configuration. Please provide a valid index or instance prop. ${s}`);if(t&&(Array.isArray(t)?t:[t]).some((e=>!e.api_key||!e.endpoint)))throw new Error(`Invalid cloud index configuration. Please provide a valid api_key and endpoint ${s}`);t&&r&&console.warn(`Both index and instance props are provided. Instance prop will be used. ${s}`)}function K(e){if(Array.isArray(e)){return new N({mergeResults:!0,indexes:e})}let t=e;return new N({api_key:t.api_key,endpoint:t.endpoint})}function Q(e){return`orama-ui-${e}-${Math.random().toString(36).substring(2,15)}`}function V(e,t,r){let s="system"===t?r:t;return e&&s&&(e.classList.remove("theme-light","theme-dark"),e.classList.add(`theme-${s}`)),s}function X(e,t,r){var s;if(e&&r&&t)for(let i of Object.keys(r))if("colors"===i){if(null!==(s=r[i])&&void 0!==s&&s[t])for(let s of Object.keys(r[i][t]))e.style.setProperty(`${s}`,r[i][t][s])}else for(let t of Object.keys(r[i]))e.style.setProperty(`${t}`,r[i][t])}(0,s.a)(q,"arrowKeysNavigation"),(0,s.a)(J,"copyToClipboard"),(0,s.a)(z,"getNonExplicitAttributes"),(0,s.a)(F,"validateCloudIndexConfig"),(0,s.a)(K,"initOramaClient"),(0,s.a)(Q,"generateRandomID"),(0,s.a)(V,"updateThemeClasses"),(0,s.a)(X,"updateCssVariables");var W=["orama-search-box","orama-chat-box"];function Y(e){var t;let r=e;for(;;){if(!r)return null;if(r instanceof ShadowRoot){let e=r.host;if(W.includes(e.tagName.toLowerCase()))return e;r=e}else r=null!==(t=r.parentNode)&&void 0!==t?t:null}}(0,s.a)(Y,"getExternalComponentHTMLElement")}}]);